<!DOCTYPE html>
<html>
<head>
    <title>Compare DLP by Study Description</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; background: #f8fafc; margin: 0; padding: 0; }
        h1 { color: #2a5d8f; }
        h2 { margin-top: 40px; color: #18446b; }
        .container { max-width: 1100px; margin: 30px auto; background: #fff; padding: 32px 32px 24px 32px; border-radius: 10px; box-shadow: 0 2px 8px #0001; }
        .search-box { margin-bottom: 30px; }
        .search-box input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #bbb;
            border-radius: 6px;
            font-size: 1em;
            width: 260px;
        }
        .study-section { margin-bottom: 60px; }
        img { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 1px 6px #0001; }
        table { border-collapse: collapse; margin: 20px 0; width: 100%; min-width: 600px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th {
            background-color: #e4eefd;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tr:nth-child(even) { background: #f9f9f9; }
        tr:nth-child(odd) { background: #fff; }
        a { color: #2a5d8f; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .nav-links { margin-top: 30px; }
        .nav-links a { margin-right: 18px; color: #2a5d8f; font-weight: bold; text-decoration: none; }
        .nav-links a:hover { text-decoration: underline; }
        @media (max-width: 800px) {
            .container { padding: 10px 2vw; }
            table, th, td { font-size: 0.97em; min-width: 0; }
        }
    </style>
    <script>
    function filterStudies() {
        var input = document.getElementById('studySearch');
        var filter = input.value.toLowerCase();
        var sections = document.getElementsByClassName('study-section');
        for (var i = 0; i < sections.length; i++) {
            var title = sections[i].getElementsByTagName('h2')[0];
            if (title.innerText.toLowerCase().indexOf(filter) > -1) {
                sections[i].style.display = '';
            } else {
                sections[i].style.display = 'none';
            }
        }
    }
    </script>
</head>
<body>
    <div class="container">
        <h1>Total DLP Comparison by Study Description</h1>
        <div class="search-box">
            <input type="text" id="studySearch" onkeyup="filterStudies()" placeholder="Filter by Study Description...">
        </div>
        {% if plots %}
            {% for plot, table in zip(plots, tables) %}
            <div class="study-section" id="{{ plot.study|replace(' ', '_') }}">
                <h2>{{ plot.study }}</h2>
                <img src="{{ url_for('static', filename=plot.plot_url.split('static/')[1]) }}" alt="DLP Comparison Plot for {{ plot.study }}">
                <h3>Data Table</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Patient ID</th>
                        <th>Study Date</th>
                        <th>Total DLP (mGyÂ·cm)</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for row in table.table %}
                    <tr>
                        <td>
                            {% if row['report_id'] %}
                            <a href="{{ url_for('view_report', report_id=row['report_id']) }}">{{ row['Patient ID'] }}</a>
                            {% else %}
                            {{ row['Patient ID'] }}
                            {% endif %}
                        </td>
                        <td>{{ row['study_date'] }}</td>
                        <td>{{ row['Total DLP'] }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        {% else %}
            <p>No studies with DLP data found.</p>
        {% endif %}
        <div class="nav-links">
            <a href="/upload">Upload More Files</a>
            <a href="/">Back to Modality Selection</a>
        </div>
    </div>
</body>
</html>
